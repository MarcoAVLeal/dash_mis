x1
contatos <- read_url_csv(url = "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EUJqJfojMwtMilqTonJmeoABp57gRp0UWzWlzdmo_xDLCA?download=1",sep = ";",enc = "latin1")
qtd_contatos_enviados <- contatos %>% dplyr::filter(CELULAR != "(44) 99890-6216") %>% dplyr::summarise(
qtd_filiais   = n(),
qtd_regionais = length(unique(Regional)),
qtd_dir       = qtd_regionais*3)
x1$`Qntd. Esperada` <- qtd_contatos_enviados %>% sum
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinydashboardPlus)
library(dplyr)
library(readxl)
library(stringr)
library(flexdashboard)
library(ggplot2)
library(plotly)
library(rmarkdown)
library(pagedown)
library(stringr)
library(RODBC)
library(RMySQL)
library(RMariaDB)
library(ggtext)
library(fresh)
library(shinyWidgets)
library(shinycssloaders)
library(DT)
library(reshape2)
library(plyr)
library(tidyverse)
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/Ea1IGOUCSa1Mjlev_QvrNLAB4I_qcKHjWy908-RxDbWPcQ?download=1"
x <- read_url_csv(onedrive_url)
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EZYuY8kORyJIoTYUo9RwWMABYEkZTA2OXtxrUXnrLef9pQ?download=1"
x1 <- read_url_csv(onedrive_url)
x1
contatos <- read_url_csv(url = "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EUJqJfojMwtMilqTonJmeoABp57gRp0UWzWlzdmo_xDLCA?download=1",sep = ";",enc = "latin1")
qtd_contatos_enviados <- contatos %>% dplyr::filter(CELULAR != "(44) 99890-6216") %>% dplyr::summarise(
qtd_filiais   = n(),
qtd_regionais = length(unique(Regional)),
qtd_dir       = qtd_regionais*3)
x1$`Qntd. Esperada` <- qtd_contatos_enviados %>% sum
df_melt         <- x1 %>% reshape2::melt(id.vars = "dia",measure.vars = c("total","pending","sent"),value.name = "Envios",variable.name= "Legenda")
df_melt$Legenda <- as.character(df_melt$Legenda)
#df_melt         <- df_melt %>% dplyr::group_by(Legenda) %>% summarise("Acumulado" = cumsum(Envios))
df_melt_acumulado  <- tapply(X = df_melt$Envios,INDEX = df_melt$Legenda,FUN = cumsum)
acumulado         <- c(df_melt_acumulado$total,df_melt_acumulado$pending,df_melt_acumulado$sent)
df_melt$Acumulado <- acumulado
medias <-  tapply(X = df_melt$Envios,INDEX = df_melt$Legenda,FUN = mean) %>% ldply(data.frame)
p1 <- ggplot(data = df_melt,aes(x= dia, y = Envios)) +
geom_point(size = 1.2, alpha = 0.75)+
geom_line(size = 1.2, alpha = 0.75,aes(color  = Legenda,group = Legenda)) +
scale_color_manual(values = c("darkgreen", "red","darkblue")) +
scale_x_continuous(breaks = seq(min(x1$dia),max(x1$dia),2))+
# scale_y_continuous(breaks = seq(0,1,0.1))+
axis.theme(title_size = 12,textsize = 12,pos_leg = "bottom",x.angle = 45,vjust = 1,hjust=1) +
geom_vline(xintercept = max(df_melt$dia),
linetype = "dashed", colour = "red", alpha = 1,size = 0.8) +
geom_hline(yintercept = sum(qtd_contatos_enviados),
linetype = "dashed", colour = "red", alpha = 1,size = 0.8)
plot <- ggplotly(p1) %>% layout(hovermode = "x", spikedistance =  -1,margin = c(0,0,0,10),
xaxis = list(title = "<b>Qntd. Envios</b>", showspikes = TRUE, titlefont = list(size = 24),
spikemode  = 'across', #toaxis, across, marker
spikesnap = 'cursor',  ticks = "outside",tickangle = -45,
showline=TRUE,tickfont = list(size = 20),fixedrange=TRUE,
showgrid=TRUE),
yaxis = list (title = "<b>Dias</b>",
spikemode  = 'across', #toaxis, across, marker
spikesnap = 'cursor', zeroline=FALSE,titlefont = list(size = 24),
showline=TRUE,tickfont = list(size = 20),fixedrange=TRUE,
showgrid=TRUE),height = 480) %>% config(displayModeBar = FALSE)
plot
plot
seq(min(x1$dia),max(x1$dia),2)
seq(min(x1$dia),max(x1$dia),days)
p1 <- ggplot(data = df_melt,aes(x= dia, y = Envios)) +
geom_point(size = 1.2, alpha = 0.75)+
geom_line(size = 1.2, alpha = 0.75,aes(color  = Legenda,group = Legenda)) +
scale_color_manual(values = c("darkgreen", "red","darkblue")) +
scale_x_continuous(breaks = seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),days)))+
# scale_y_continuous(breaks = seq(0,1,0.1))+
axis.theme(title_size = 12,textsize = 12,pos_leg = "bottom",x.angle = 45,vjust = 1,hjust=1) +
geom_vline(xintercept = max(df_melt$dia),
linetype = "dashed", colour = "red", alpha = 1,size = 0.8) +
geom_hline(yintercept = sum(qtd_contatos_enviados),
linetype = "dashed", colour = "red", alpha = 1,size = 0.8)
plot <- ggplotly(p1) %>% layout(hovermode = "x", spikedistance =  -1,margin = c(0,0,0,10),
xaxis = list(title = "<b>Qntd. Envios</b>", showspikes = TRUE, titlefont = list(size = 24),
spikemode  = 'across', #toaxis, across, marker
spikesnap = 'cursor',  ticks = "outside",tickangle = -45,
showline=TRUE,tickfont = list(size = 20),fixedrange=TRUE,
showgrid=TRUE),
yaxis = list (title = "<b>Dias</b>",
spikemode  = 'across', #toaxis, across, marker
spikesnap = 'cursor', zeroline=FALSE,titlefont = list(size = 24),
showline=TRUE,tickfont = list(size = 20),fixedrange=TRUE,
showgrid=TRUE),height = 480) %>% config(displayModeBar = FALSE)
plot
seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),days))
seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),1)
seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),1))
seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),1))
as.Date(x1$dia)
min(as.Date(x1$dia)
min(as.Date(x1$dia))
min(as.Date(x1$dia))
x1$dia <- lubridate::as_date(x1$dia
)
x1$dia
x1$dia <- lubridate::as_date(x1$dia)
seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),1))
p1 <- ggplot(data = df_melt,aes(x= dia, y = Envios)) +
geom_point(size = 1.2, alpha = 0.75)+
geom_line(size = 1.2, alpha = 0.75,aes(color  = Legenda,group = Legenda)) +
scale_color_manual(values = c("darkgreen", "red","darkblue")) +
scale_x_continuous(breaks = seq(min(as.Date(x1$dia)),as.Date(max(x1$dia),by = "days")))+
# scale_y_continuous(breaks = seq(0,1,0.1))+
axis.theme(title_size = 12,textsize = 12,pos_leg = "bottom",x.angle = 45,vjust = 1,hjust=1) +
geom_vline(xintercept = max(df_melt$dia),
linetype = "dashed", colour = "red", alpha = 1,size = 0.8) +
geom_hline(yintercept = sum(qtd_contatos_enviados),
linetype = "dashed", colour = "red", alpha = 1,size = 0.8)
max(x1$dia)
seq(min(x1$dia),max(x1$dia),by = "days")
seq(min(x1$dia),max(x1$dia),by = "days",lenght.out = 20)
seq(min(x1$dia),max(x1$dia),by = "days",lenght.out = 10)
seq(min(x1$dia),max(x1$dia),by = "2days",lenght.out = 10)
seq(min(x1$dia),max(x1$dia),by = "2 days",lenght.out = 10)
x1$dia %>% month
x1$dia %>% lubridate::month
lubridate::month(x1$dia)
lenght(unique(lubridate::month(x1$dia) ))
length(unique(lubridate::month(x1$dia) ))
seq(min(x1$dia),max(x1$dia),by = paste(length(unique(lubridate::month(x1$dia))," days"))
seq(min(x1$dia),max(x1$dia),by = paste(length(unique(lubridate::month(x1$dia))," days")) )
seq(min(x1$dia),max(x1$dia),by = paste(length(unique(lubridate::month(x1$dia))," days")) )
seq(min(x1$dia),max(x1$dia),by = paste(length(unique(lubridate::month(x1$dia)))," days") )
paste(length(unique(lubridate::month(x1$dia)))," days")
paste(length(unique(lubridate::month(x1$dia))),"days")
seq(min(x1$dia),max(x1$dia),by = paste(length(unique(lubridate::month(x1$dia))),"days") )
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
source(file = "https://raw.githubusercontent.com/MarcoAVLeal/dash_mis/main/pagina1.R",encoding = "UTF-8",local = F)
source(file = "https://raw.githubusercontent.com/MarcoAVLeal/dash_mis/main/pagina1.R",encoding = "UTF-8",local = F)
runApp()
runApp()
runApp()
runApp()
runApp()
path_pg1 <-  source(file = "https://raw.githubusercontent.com/MarcoAVLeal/dash_mis/main/pagina1.R",encoding = "UTF-8",local = F)
path_pg2 <-  source(file = "https://raw.githubusercontent.com/MarcoAVLeal/dash_mis/main/pagina2.R",encoding = "UTF-8",local = F)
path_pg1
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
unique(lubridate::month(x1$dia))
lubridate::month(x1$dia) == max(unique(unique(lubridate::month(x1$dia))))
mes_atual = lubridate::month(x1$dia) == max(unique(unique(lubridate::month(x1$dia))))
mes_atual
lubridate::month(x1$dia) == max(lubridate::month(x1$dia))
mes_atual = lubridate:today() == max(lubridate::month(x1$dia))
mes_atual
mes_atual = lubridate::today() == max(lubridate::month(x1$dia))
mes_atual = lubridate::today() == max(lubridate::month(x1$dia))
lubridate::today() == max(lubridate::month(x1$dia))
lubridate::today()
mes_atual = lubridate::today() == max(lx1$dia)
mes_atual
mes_atual = lubridate::today() == max(x1$dia)
mes_atual
mes_atual = lubridate::today() == x1$dia
mes_atual
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp()
knitr::opts_chunk$set(echo = FALSE)
dygraphs::dygraph(nhtemp, main = "New Haven Temperatures")
# Capture a Shiny app
knitr::include_app('https://gallery.shinyapps.io/goog-trend-index/')
#rm(list=ls())
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinydashboardPlus)
library(dplyr)
library(readxl)
library(stringr)
library(flexdashboard)
library(ggplot2)
library(plotly)
library(rmarkdown)
library(pagedown)
library(stringr)
library(RODBC)
library(RMySQL)
library(RMariaDB)
library(ggtext)
library(fresh)
library(shinyWidgets)
library(shinycssloaders)
library(DT)
library(reshape2)
library(plyr)
library(tidyverse)
#source(file = "funcoes.R",encoding = "UTF-8")
read_url_csv <- function(url, sep = ",",enc = "UTF-8"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read.csv(tmpFile, sep = sep,encoding = enc)
return(url_csv)
}
read_url_xlsx <- function(url,sheet = "Calendario"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read_xlsx(path = tmpFile,sheet = sheet)
return(url_csv)
}
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EbsSsZPj4ntMvyRUG-0QYa4BTEQUCw8VXlCqTriyMQcYiw?download=1"
destfile <- "calendario.xlsx"
curl::curl_download(url, destfile)
calendario <- read_excel(destfile,sheet = "Calendario")
calendario         = calendario[c("Dia","Class Não Útil","Dia Útil2")]
colnames(calendario) <- c("Data","Dia_util","Dia_Util2")
calendario$Class_Dia <- is.na(calendario$Dia_util)
calendario$Data      <- as.Date(calendario$Data,format = "%d/%m/%Y")
calendario$Class_Dia <- ifelse(calendario$`Dia_Util2` == "Sábado",TRUE,calendario$Class_Dia)
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ESjlRAy5mzVJh3LRucNvoTYBa5x7ReX2691dJ-5uwaob4w?download=1"
df <- read_url_csv(onedrive_url,enc = "latin1")
names_df          <- c("ID","Tipo","Pipeline", "Fase do negocio","Negocio Recorrente","Negocio Repetido","Contato Fonte","Modificado por ID","Criado por","Pessoa reponsavel ID",
"Data prevista de fechamento","Data de inicio","Valor do emprestimo","Origem do Cliente","Data exportacao","Contato","Grupo de fase" ,
"Base","Produto Crefaz", "Fase automacao",  "Data negociar","Data analisar", "Data prospectar","Modificado em","Desafio","Desafio retencao","primeira_resposta_do_cliente","resposta_do_cliente","cpf","retrabalho_desafio"
)
colnames(df) <- names_df
df$`Fase do negocio` <- ifelse(df$`Fase do negocio` == "EM ANÃ\u0081LISE","EM ANÁLISE",df$`Fase do negocio`)
df$`Pessoa reponsavel ID`          <- as.character(df$`Pessoa reponsavel ID` )
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ES9Opw7qVkROh6yxmaC8ARQB1_RuzanE2l8fl3U7p6r4KQ?download=1"
users             <- read_url_csv(onedrive_url,sep = ";",enc = "latin1")
users$ID          <- as.character(users$ID)
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EaODUUKwdOFJtbyx6MQHshsBjMAYRqYYyXr-el08rDnpxQ?download=1"
destfile <- "regionais.xlsx"
curl::curl_download(url, destfile)
regionais <- read_excel(destfile,sheet = "Planilha1")
df                <- left_join(x = df,y = users,by=c("Pessoa reponsavel ID"="ID"),keep=TRUE,suffix = c("_LEADS","_users"))
#df                <- left_join(x = df,y = regionais,by=c("Departamento"="Departamento"),keep=TRUE,suffix = c("_LEADS","_reg"))
df$Regional %>% unique
colnames(df)[colnames(df) == "Departamento"] <- "Lojas"
df$Lojas %>% unique
df %>% filter(Lojas == "Loja CFZ Itacibá")
#rm(list=ls())
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinydashboardPlus)
library(dplyr)
library(readxl)
library(stringr)
library(flexdashboard)
library(ggplot2)
library(plotly)
library(rmarkdown)
library(pagedown)
library(stringr)
library(RODBC)
library(RMySQL)
library(RMariaDB)
library(ggtext)
library(fresh)
library(shinyWidgets)
library(shinycssloaders)
library(DT)
library(reshape2)
library(plyr)
library(tidyverse)
#source(file = "funcoes.R",encoding = "UTF-8")
read_url_csv <- function(url, sep = ",",enc = "UTF-8"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read.csv(tmpFile, sep = sep,encoding = enc)
return(url_csv)
}
read_url_xlsx <- function(url,sheet = "Calendario"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read_xlsx(path = tmpFile,sheet = sheet)
return(url_csv)
}
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EbsSsZPj4ntMvyRUG-0QYa4BTEQUCw8VXlCqTriyMQcYiw?download=1"
destfile <- "calendario.xlsx"
curl::curl_download(url, destfile)
calendario <- read_excel(destfile,sheet = "Calendario")
calendario         = calendario[c("Dia","Class Não Útil","Dia Útil2")]
colnames(calendario) <- c("Data","Dia_util","Dia_Util2")
calendario$Class_Dia <- is.na(calendario$Dia_util)
calendario$Data      <- as.Date(calendario$Data,format = "%d/%m/%Y")
calendario$Class_Dia <- ifelse(calendario$`Dia_Util2` == "Sábado",TRUE,calendario$Class_Dia)
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ESjlRAy5mzVJh3LRucNvoTYBa5x7ReX2691dJ-5uwaob4w?download=1"
df <- read_url_csv(onedrive_url,enc = "latin1")
names_df          <- c("ID","Tipo","Pipeline", "Fase do negocio","Negocio Recorrente","Negocio Repetido","Contato Fonte","Modificado por ID","Criado por","Pessoa reponsavel ID",
"Data prevista de fechamento","Data de inicio","Valor do emprestimo","Origem do Cliente","Data exportacao","Contato","Grupo de fase" ,
"Base","Produto Crefaz", "Fase automacao",  "Data negociar","Data analisar", "Data prospectar","Modificado em","Desafio","Desafio retencao","primeira_resposta_do_cliente","resposta_do_cliente","cpf","retrabalho_desafio"
)
colnames(df) <- names_df
df$`Fase do negocio` <- ifelse(df$`Fase do negocio` == "EM ANÃ\u0081LISE","EM ANÁLISE",df$`Fase do negocio`)
df$`Pessoa reponsavel ID`          <- as.character(df$`Pessoa reponsavel ID` )
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ES9Opw7qVkROh6yxmaC8ARQB1_RuzanE2l8fl3U7p6r4KQ?download=1"
users             <- read_url_csv(onedrive_url,sep = ";",enc = "latin1")
users$ID          <- as.character(users$ID)
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EaODUUKwdOFJtbyx6MQHshsBjMAYRqYYyXr-el08rDnpxQ?download=1"
destfile <- "regionais.xlsx"
curl::curl_download(url, destfile)
regionais <- read_excel(destfile,sheet = "Planilha1")
users$Departamento
users$Departamento %>% unique
#rm(list=ls())
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinydashboardPlus)
library(dplyr)
library(readxl)
library(stringr)
library(flexdashboard)
library(ggplot2)
library(plotly)
library(rmarkdown)
library(pagedown)
library(stringr)
library(RODBC)
library(RMySQL)
library(RMariaDB)
library(ggtext)
library(fresh)
library(shinyWidgets)
library(shinycssloaders)
library(DT)
library(reshape2)
library(plyr)
library(tidyverse)
#source(file = "funcoes.R",encoding = "UTF-8")
read_url_csv <- function(url, sep = ",",enc = "UTF-8"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read.csv(tmpFile, sep = sep,encoding = enc)
return(url_csv)
}
read_url_xlsx <- function(url,sheet = "Calendario"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read_xlsx(path = tmpFile,sheet = sheet)
return(url_csv)
}
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EbsSsZPj4ntMvyRUG-0QYa4BTEQUCw8VXlCqTriyMQcYiw?download=1"
destfile <- "calendario.xlsx"
curl::curl_download(url, destfile)
calendario <- read_excel(destfile,sheet = "Calendario")
calendario         = calendario[c("Dia","Class Não Útil","Dia Útil2")]
colnames(calendario) <- c("Data","Dia_util","Dia_Util2")
calendario$Class_Dia <- is.na(calendario$Dia_util)
calendario$Data      <- as.Date(calendario$Data,format = "%d/%m/%Y")
calendario$Class_Dia <- ifelse(calendario$`Dia_Util2` == "Sábado",TRUE,calendario$Class_Dia)
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ESjlRAy5mzVJh3LRucNvoTYBa5x7ReX2691dJ-5uwaob4w?download=1"
df <- read_url_csv(onedrive_url,enc = "latin1")
names_df          <- c("ID","Tipo","Pipeline", "Fase do negocio","Negocio Recorrente","Negocio Repetido","Contato Fonte","Modificado por ID","Criado por","Pessoa reponsavel ID",
"Data prevista de fechamento","Data de inicio","Valor do emprestimo","Origem do Cliente","Data exportacao","Contato","Grupo de fase" ,
"Base","Produto Crefaz", "Fase automacao",  "Data negociar","Data analisar", "Data prospectar","Modificado em","Desafio","Desafio retencao","primeira_resposta_do_cliente","resposta_do_cliente","cpf","retrabalho_desafio"
)
colnames(df) <- names_df
df$`Fase do negocio` <- ifelse(df$`Fase do negocio` == "EM ANÃ\u0081LISE","EM ANÁLISE",df$`Fase do negocio`)
df$`Pessoa reponsavel ID`          <- as.character(df$`Pessoa reponsavel ID` )
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ES9Opw7qVkROh6yxmaC8ARQB1_RuzanE2l8fl3U7p6r4KQ?download=1"
users             <- read_url_csv(onedrive_url,sep = ";",enc = "latin1")
users$ID          <- as.character(users$ID)
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EaODUUKwdOFJtbyx6MQHshsBjMAYRqYYyXr-el08rDnpxQ?download=1"
destfile <- "regionais.xlsx"
curl::curl_download(url, destfile)
regionais <- read_excel(destfile,sheet = "Planilha1")
users$Departamento %>% unique
df                <- left_join(x = df,y = users,by=c("Pessoa reponsavel ID"="ID"),keep=TRUE,suffix = c("_LEADS","_users"))
#df                <- left_join(x = df,y = regionais,by=c("Departamento"="Departamento"),keep=TRUE,suffix = c("_LEADS","_reg"))
users$Departamento %>% unique
df                <- left_join(x = df,y = users,by=c("Pessoa reponsavel ID"="ID"),keep=TRUE,suffix = c("_LEADS","_users"))
df$Regional %>% unique
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. ES 2 Lojas CFZ",replacement = "SIMONE FREITAS")
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. RJ Lojas CFZ",replacement = "MAYSA CARVALHO")
#rm(list=ls())
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinydashboardPlus)
library(dplyr)
library(readxl)
library(stringr)
library(flexdashboard)
library(ggplot2)
library(plotly)
library(rmarkdown)
library(pagedown)
library(stringr)
library(RODBC)
library(RMySQL)
library(RMariaDB)
library(ggtext)
library(fresh)
library(shinyWidgets)
library(shinycssloaders)
library(DT)
library(reshape2)
library(plyr)
library(tidyverse)
#source(file = "funcoes.R",encoding = "UTF-8")
read_url_csv <- function(url, sep = ",",enc = "UTF-8"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read.csv(tmpFile, sep = sep,encoding = enc)
return(url_csv)
}
read_url_xlsx <- function(url,sheet = "Calendario"){
tmpFile <- tempfile()
download.file(url, destfile = tmpFile)
url_csv <- read_xlsx(path = tmpFile,sheet = sheet)
return(url_csv)
}
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EbsSsZPj4ntMvyRUG-0QYa4BTEQUCw8VXlCqTriyMQcYiw?download=1"
destfile <- "calendario.xlsx"
curl::curl_download(url, destfile)
calendario <- read_excel(destfile,sheet = "Calendario")
calendario         = calendario[c("Dia","Class Não Útil","Dia Útil2")]
colnames(calendario) <- c("Data","Dia_util","Dia_Util2")
calendario$Class_Dia <- is.na(calendario$Dia_util)
calendario$Data      <- as.Date(calendario$Data,format = "%d/%m/%Y")
calendario$Class_Dia <- ifelse(calendario$`Dia_Util2` == "Sábado",TRUE,calendario$Class_Dia)
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ESjlRAy5mzVJh3LRucNvoTYBa5x7ReX2691dJ-5uwaob4w?download=1"
df <- read_url_csv(onedrive_url,enc = "latin1")
names_df          <- c("ID","Tipo","Pipeline", "Fase do negocio","Negocio Recorrente","Negocio Repetido","Contato Fonte","Modificado por ID","Criado por","Pessoa reponsavel ID",
"Data prevista de fechamento","Data de inicio","Valor do emprestimo","Origem do Cliente","Data exportacao","Contato","Grupo de fase" ,
"Base","Produto Crefaz", "Fase automacao",  "Data negociar","Data analisar", "Data prospectar","Modificado em","Desafio","Desafio retencao","primeira_resposta_do_cliente","resposta_do_cliente","cpf","retrabalho_desafio"
)
colnames(df) <- names_df
df$`Fase do negocio` <- ifelse(df$`Fase do negocio` == "EM ANÃ\u0081LISE","EM ANÁLISE",df$`Fase do negocio`)
df$`Pessoa reponsavel ID`          <- as.character(df$`Pessoa reponsavel ID` )
onedrive_url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/ES9Opw7qVkROh6yxmaC8ARQB1_RuzanE2l8fl3U7p6r4KQ?download=1"
users             <- read_url_csv(onedrive_url,sep = ";",enc = "latin1")
users$ID          <- as.character(users$ID)
library(readxl)
url <- "https://crefaz-my.sharepoint.com/:x:/g/personal/gestaodedados4_crefaz_onmicrosoft_com/EaODUUKwdOFJtbyx6MQHshsBjMAYRqYYyXr-el08rDnpxQ?download=1"
destfile <- "regionais.xlsx"
curl::curl_download(url, destfile)
regionais <- read_excel(destfile,sheet = "Planilha1")
users$Departamento %>% unique
df                <- left_join(x = df,y = users,by=c("Pessoa reponsavel ID"="ID"),keep=TRUE,suffix = c("_LEADS","_users"))
df$Regional %>% unique
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. ES 2 Lojas CFZ",replacement = "SIMONE FREITAS")
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. RJ Lojas CFZ",replacement = "MAYSA CARVALHO")
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. RS Lojas CFZ",replacement = "WAGNER RIBEIRO")
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. CE lojas CFZ",replacement = "GILBERTO FELICIO")
df$Regional       <- str_replace(string = df$Regional,pattern = "Super. Lojas SC",replacement = "REGIONAL SC")
df$Regional       <- str_replace(string = df$Regional,pattern = "Sup. Estadual Eliana",replacement = "ELIANA PORRINO")
df$Regional       <- str_replace(string = df$Regional,pattern = "Regional Yrlon",replacement = "YRLON ALVES")
df$Regional       <- str_replace(string = df$Regional,pattern = "Regional Mirele CFZ",replacement = "MIRELE DUARTE")
df$Regional       <- str_replace(string = df$Regional,pattern = "Regional Helen",replacement = "HELEN CAROLINA")
df$Regional       <- str_replace(string = df$Regional,pattern = "Regional Dejamile",replacement = "DEJAMILE SOUZA")
df$Regional       <- str_replace(string = df$Regional,pattern = "Regional Helen",replacement = "HELEN CAROLINA")
df$Regional       <- str_replace(string = df$Regional,pattern = "Regional Igor",replacement = "IGOR ASSIS")
colnames(df)[colnames(df) == "Departamento"] <- "Lojas"
df$Lojas %>% unique
df                <- df %>% filter(str_detect(string = Lojas,pattern = "Loja CFZ"))
df %>% filter(Lojas == "Loja CFZ Itacibá")
df                <- df %>% mutate("Fase do negocio" = ifelse(`Fase do negocio` == "PAGO AO CLIENTE","PAGO",`Fase do negocio`))
df                <- df %>% mutate("Fase do negocio" = ifelse(`Fase do negocio` == "EM ANÁLISE","EM ANÁLISE",`Fase do negocio`))
df                <- df %>% mutate("Origem do Cliente"  = ifelse(`Origem do Cliente` == "" | is.na(`Origem do Cliente`) | `Origem do Cliente` == "NA"  ,"Não identificada",`Origem do Cliente`),
# "Fonte"              = ifelse(`Contato Fonte` =="",`Lead Fonte`,`Contato Fonte`),
"Origem do Cliente1" = ifelse(!is.na(`Contato Fonte`) ,"Fonte", `Origem do Cliente`),
"Data fechado"       = ifelse(`Fase do negocio` == "PAGO" | `Fase do negocio` == "DESAFIO",`Data prevista de fechamento`, NA),
"Data criado"        = ifelse(`Origem do Cliente1` == "Fonte" | `Origem do Cliente1` =="Não identificada",NA,`Data de inicio`))
#df$`Criado em`         <- as.Date(df$`Criado em`,format = "%d/%m/%Y")
df$`Data fechado`       <- lubridate::as_date(df$`Data fechado` , format = "%Y-%m-%d %H:%M:%S")
df$`Data analisar`      <- lubridate::as_date(df$`Data analisar`, format = "%Y-%m-%d %H:%M:%S")
df$`Data criado`        <- lubridate::as_date(df$`Data criado`, format = "%Y-%m-%d %H:%M:%S")
df$`Data negociar`      <- lubridate::as_date(df$`Data negociar`, format = "%Y-%m-%d %H:%M:%S")
df$`Data prospectar`    <- lubridate::as_date(df$`Data prospectar`, format = "%Y-%m-%d %H:%M:%S")
df$`Data de inicio`     <- lubridate::as_date(df$`Data de inicio`, format = "%Y-%m-%d %H:%M:%S")
df$`Modificado em`      <- lubridate::as_date(df$`Modificado em` , format = "%Y-%m-%d %H:%M:%S")
df1 <- df
df$Lojas %>% unique
df %>% filter(Lojas == "Loja CFZ Itacibá")
users$Departamento %>% unique
